import os
import sys
import random
import json
import numpy as np
from ast import literal_eval 
import pickle
from preprocess_new import generate_csv




def get_data(path):                                                            # gets the file names and generates test data from the given location
	file_names = os.listdir(path)
	data = np.array(generate_csv(path))	
	return data,file_names

def predict(data,file_names):                                                  # Makes prediction based on model and writes to dynamic.csv file
	print(data.shape)	
	data = data[:,0:-1]
	model = pickle.load(open('model','rb'))
	predict = model.predict(data)
	with open('dynamic.csv','w') as file:
		file.write('File_Hash,Predicted Label\n')
		for i in range(len(file_names)):
			if predict[i]==0:
				file.write(file_names[i][:-5]+','+'B'+'\n')
			else:
				file.write(file_names[i][:-5]+','+'M'+'\n')


if __name__ == "__main__":
	test_path = sys.argv[1]
	data,file_names = get_data(test_path)
	predict(data,file_names)
